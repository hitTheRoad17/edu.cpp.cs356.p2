package edu.cpp.cs356;

import javax.swing.tree.DefaultTreeModel;

public class AdminPanel extends javax.swing.JFrame {

    private static AdminPanel instance;

    static AdminPanel getInstance() {
        if (instance == null) {
            synchronized (AdminPanel.class) {
                if (instance == null) {
                    instance = new AdminPanel();
                }
            }
        }
        return instance;
    }

    /**
     * Creates new form AdminPanel
     */
    public AdminPanel() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        userTree = new javax.swing.JTree();
        userId = new javax.swing.JTextField();
        user = new javax.swing.JButton();
        group = new javax.swing.JButton();
        groupId = new javax.swing.JTextField();
        userView = new javax.swing.JButton();
        totalUser = new javax.swing.JButton();
        totalGroup = new javax.swing.JButton();
        totalMsg = new javax.swing.JButton();
        positivePercentage = new javax.swing.JButton();
        jScrollPane3 = new javax.swing.JScrollPane();
        message = new javax.swing.JTextPane();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        javax.swing.tree.DefaultMutableTreeNode treeNode1 = new javax.swing.tree.DefaultMutableTreeNode("root");
        userTree.setModel(new javax.swing.tree.DefaultTreeModel(treeNode1));
        jScrollPane1.setViewportView(userTree);

        userId.setText("Enter User ID");

        user.setText("Add User");
        user.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                userActionPerformed(evt);
            }
        });

        group.setText("Add Group");
        group.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                groupActionPerformed(evt);
            }
        });

        groupId.setText("Enter Group ID");

        userView.setText("Open User View");
        userView.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                userViewActionPerformed(evt);
            }
        });

        totalUser.setText("Show User Total");
        totalUser.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                totalUserActionPerformed(evt);
            }
        });

        totalGroup.setText("Show Group Total");
        totalGroup.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                totalGroupActionPerformed(evt);
            }
        });

        totalMsg.setText("Show Messages Total");
        totalMsg.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                totalMsgActionPerformed(evt);
            }
        });

        positivePercentage.setText("Show Positive Percentage");
        positivePercentage.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                positivePercentageActionPerformed(evt);
            }
        });

        jScrollPane3.setViewportView(message);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 266, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(groupId, javax.swing.GroupLayout.PREFERRED_SIZE, 157, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(group, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(userId, javax.swing.GroupLayout.PREFERRED_SIZE, 157, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(user, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addComponent(userView, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(totalMsg, javax.swing.GroupLayout.DEFAULT_SIZE, 171, Short.MAX_VALUE)
                            .addComponent(totalUser, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(positivePercentage, javax.swing.GroupLayout.DEFAULT_SIZE, 215, Short.MAX_VALUE)
                            .addComponent(totalGroup, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                    .addComponent(jScrollPane3))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(user, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(group, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(groupId, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addComponent(userId, javax.swing.GroupLayout.PREFERRED_SIZE, 56, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(userView, javax.swing.GroupLayout.PREFERRED_SIZE, 66, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, 119, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(totalUser, javax.swing.GroupLayout.PREFERRED_SIZE, 52, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(totalGroup, javax.swing.GroupLayout.PREFERRED_SIZE, 52, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(totalMsg, javax.swing.GroupLayout.PREFERRED_SIZE, 52, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(positivePercentage, javax.swing.GroupLayout.PREFERRED_SIZE, 52, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    // add user
    private void userActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_userActionPerformed
        DefaultTreeModel dtm = (DefaultTreeModel) userTree.getModel();
        Component root = (Group) dtm.getRoot();
        Component selectedNode = (Component) userTree.getLastSelectedPathComponent();

        if (!userId.getText().trim().equals("")) {
            if (selectedNode != null) {
                if (selectedNode instanceof Group) {
                    Component newUser = new User(userId.getText().trim(), (Group) selectedNode);

                    message.setText("");

                    dtm.insertNodeInto(newUser, selectedNode, WIDTH);
                    dtm.reload();
                } else {
                    message.setText("User already in the group");
                }
            } else {
                Component newUser = new User(userId.getText().trim(), (Group) root);
                dtm.insertNodeInto(newUser, root, WIDTH);
                dtm.reload();
            }
        } else {
            message.setText("Please enter a valid ID");
        }
    }//GEN-LAST:event_userActionPerformed

    // add group
    private void groupActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_groupActionPerformed
        DefaultTreeModel dtm = (DefaultTreeModel) userTree.getModel();
        Component root = (Group) dtm.getRoot();
        Component selectedNode = (Component) userTree.getLastSelectedPathComponent();

        if (!groupId.getText().trim().equals("")) {
            if (selectedNode != null) {
                if (selectedNode instanceof Group) {
                    Component newGroup = new Group(groupId.getText().trim(), (Group) selectedNode);

                    message.setText("");

                    dtm.insertNodeInto(newGroup, selectedNode, WIDTH);
                    dtm.reload();
                } else {
                    message.setText("Group already in the group");
                }
            } else {
                Component newGroup = new User(groupId.getText().trim(), (Group) root);
                dtm.insertNodeInto(newGroup, root, WIDTH);
                dtm.reload();
            }
        } else {
            message.setText("Please enter a valid ID");
        }
    }//GEN-LAST:event_groupActionPerformed

    // open user view
    private void userViewActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_userViewActionPerformed


    }//GEN-LAST:event_userViewActionPerformed

    // show user total
    private void totalUserActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_totalUserActionPerformed
        ComponentVisitor cv = (ComponentVisitor) traverse(new ComponentVisitor());
        message.setText(String.valueOf(cv.getTotalUsers()));
    }//GEN-LAST:event_totalUserActionPerformed

    // show group total
    private void totalGroupActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_totalGroupActionPerformed
        ComponentVisitor cv = (ComponentVisitor) traverse(new ComponentVisitor());
        message.setText(String.valueOf(cv.getTotalGroups()));
    }//GEN-LAST:event_totalGroupActionPerformed

    // show message total
    private void totalMsgActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_totalMsgActionPerformed
        TweetVisitor tv = (TweetVisitor) traverse(new ComponentVisitor());
        message.setText(String.valueOf(tv.getTotalTweets()));
    }//GEN-LAST:event_totalMsgActionPerformed

    // show positive percetnage
    private void positivePercentageActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_positivePercentageActionPerformed
        TweetVisitor tv = (TweetVisitor) traverse(new ComponentVisitor());
        message.setText(String.valueOf(tv.calcPercentage()));
    }//GEN-LAST:event_positivePercentageActionPerformed

    private Visitor traverse(Visitor v) {
        DefaultTreeModel dtm = (DefaultTreeModel) userTree.getModel();
        Component root = (Group) dtm.getRoot();
        traverse(root, v);
        return v;
    }

    private void traverse(Component c, Visitor v) {
        c.accept(v);
        if (!c.isLeaf()) {
            for (Component cpt : c.children) {
                traverse(cpt, v);
            }
        }
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton group;
    private javax.swing.JTextField groupId;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JTextPane message;
    private javax.swing.JButton positivePercentage;
    private javax.swing.JButton totalGroup;
    private javax.swing.JButton totalMsg;
    private javax.swing.JButton totalUser;
    private javax.swing.JButton user;
    private javax.swing.JTextField userId;
    private javax.swing.JTree userTree;
    private javax.swing.JButton userView;
    // End of variables declaration//GEN-END:variables

}
